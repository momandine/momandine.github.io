<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
<channel>
        <title>Amandine Lee</title>
        <description>Amandine Lee - Amandine Lee</description>
        <link>amandinemlee.com</link>
        <link>amandinemlee.com</link>
        <lastBuildDate>2015-09-30T22:34:35-07:00</lastBuildDate>
        <pubDate>2015-09-30T22:34:35-07:00</pubDate>
        <ttl>1800</ttl>


        <item>
                <title>Linux block devices</title>
                <description>
&lt;p&gt;One day at work I was presented with a problem. We use &lt;a href=&quot;http://aws.amazon.com/ec2/&quot;&gt;Amazon Web Services’ EC2&lt;/a&gt; 
for a lot of things. An instance was storing lots of data in a specific directory, and it ran out of space. &lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The machine at hand: an Ubuntu 14.04 instance, the Trusty Tahr. I made a blank micro instance for demo purposes. &lt;/li&gt;
  &lt;li&gt;The solution: Elastic Block Store, or EBS.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;what-is-an-ebs-volume&quot;&gt;What is an EBS volume?&lt;/h3&gt;

&lt;p&gt;From the Amazon documentation, &lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;An Amazon EBS volume is a durable, block-level storage device that you can attach to a single EC2 instance.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Basically it’s a bit of storage that can have a filesystem and be treated by the operating system mostly like it would a physical drive you add or remove from your computer. However, it’s connected the the server over the network, and can therefore be umounted and saved or shifted from one instance to the next. They’re a really core AWS product - most EC2 instances these days are “EBS-backed”, meaning an EBS volume taken from a standard snapshot is mounted at the root directory. You can turn off the instance and keep all its data intact if you want. &lt;/p&gt;

&lt;p&gt;The other kind of instance is “&lt;a href=&quot;http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html&quot;&gt;instance store&lt;/a&gt;”, which doesn’t persist and mostly seems to be around for legacy reasons.&lt;/p&gt;

&lt;h3 id=&quot;mounting&quot;&gt;Mounting&lt;/h3&gt;

&lt;p&gt;What does all of this mounting mean? Presumably no steeds are involved. &lt;/p&gt;

&lt;p&gt;Well, a computer’s files can be spread across a bunch of different storage devices. &lt;a href=&quot;http://en.wikipedia.org/wiki/Mount_%28Unix%29&quot;&gt;Mount&lt;/a&gt; is the Unix command that tells your operating system that some storage with a filesystem is available and what its “mount point” is, i.e. the part of the directory tree for which it should be used. If you were dealing with a physical computer sitting on your lap or desk, you might use &lt;code&gt;mount&lt;/code&gt; to indicate a new SD drive or DVD. As you might expect, &lt;code&gt;umount&lt;/code&gt; is its opposite, and disengages the storage. &lt;/p&gt;

&lt;p&gt;Some really simple sample usage:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$mount  # Just tells you what&#39;s going on currently. 
/dev/xvda1 on / type ext4 (rw,discard)
proc on /proc type proc (rw,noexec,nosuid,nodev)
sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)
none on /sys/fs/cgroup type tmpfs (rw)
none on /sys/fs/fuse/connections type fusectl (rw)
none on /sys/kernel/debug type debugfs (rw)
none on /sys/kernel/security type securityfs (rw)
udev on /dev type devtmpfs (rw,mode=0755)
devpts on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=0620)
tmpfs on /run type tmpfs (rw,noexec,nosuid,size=10%,mode=0755)
none on /run/lock type tmpfs (rw,noexec,nosuid,nodev,size=5242880)
none on /run/shm type tmpfs (rw,nosuid,nodev)
none on /run/user type tmpfs (rw,noexec,nosuid,nodev,size=104857600,mode=0755)
none on /sys/fs/pstore type pstore (rw)
systemd on /sys/fs/cgroup/systemd type cgroup (rw,noexec,nosuid,nodev,none,name=systemd)

$mount /dev/xvdh ~/data # Would put the xvdf drive in my ~/data direcotry
$umount /dev/xvdh  # Unmount! Same things as `umount ~/data` really
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Meanwhile, need to know how much space and you have and where? &lt;code&gt;df&lt;/code&gt; is &lt;a href=&quot;http://tldp.org/LDP/abs/html/devref1.html&quot;&gt;your gal&lt;/a&gt;. This is what it looks like for my test instance&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/dev/xvda1       8125880 788204   6901864  11% /
none                   4      0         4   0% /sys/fs/cgroup
udev              290380     12    290368   1% /dev
tmpfs              60272    188     60084   1% /run
none                5120      0      5120   0% /run/lock
none              301356      0    301356   0% /run/shm
none              102400      0    102400   0% /run/user
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;so-wheres-my-ebs-volume&quot;&gt;So… where’s my EBS volume?&lt;/h3&gt;

&lt;p&gt;First of all, talking specifically about AWS, you have to do some configuration dances before you get an actual extra EBS volume anywhere near your instance. As you can see from the output above, there is already a device called &lt;code&gt;/dev/xvda1&lt;/code&gt; hanging out at the root directory, which is the root device. &lt;/p&gt;

&lt;p&gt;When you’re creating an instance, there’s a handy button that says “Add new volume” and then you have to choose a name for your volume, use a specific snapshot, and various other specifications. The names are things like “/dev/sdb1”. &lt;/p&gt;

&lt;p&gt;What does this name mean? The helpful popover says:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Depending on the block device driver of the selected AMI’s kernel, the device may be attached with a different name than what you specify. &lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Wat?&lt;/p&gt;

&lt;h3 id=&quot;a-little-history-of-technology&quot;&gt;A little history of technology&lt;/h3&gt;
&lt;p&gt;EBS volumes are “block devices”, which means they read data in and out in chunks, do some buffering, allow random access, and in general have nice high level features. Their counterpoint is the character device, which is less abstracted from its hardware implementation. They are sound cards, modems, etc. Their interfaces exist as “special” or “device” files which live in the &lt;a href=&quot;http://www.tldp.org/LDP/sag/html/dev-fs.html&quot;&gt;&lt;code&gt;/dev&lt;/code&gt; directory&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The options for block device names in the AWS console pretty much all start with &lt;code&gt;sd[a-z]{2}&lt;/code&gt;. This stands for “SCSI disk”, which is pronounced like “scuzzy disk”. SCSI is a protocol for interacting with storage developed long ago. It was the newfangled way to connect storage to your computer compared to IDE cables, which are those ribbons of wire I at least remember my dad pulling out of the computer to detach a floppy drive in the ’90s. &lt;/p&gt;

&lt;p&gt;More nomenclature: &lt;code&gt;hd&lt;/code&gt; would indicate a hard disk, and &lt;code&gt;xvd&lt;/code&gt; is Xen virtual disk. Everything in Amazon is virtualized, and the tricky thing is that only some kinds of instances understand that and adjust operations to account for it. Those that do, like Ubuntu 14.04, convert the &lt;code&gt;sd&lt;/code&gt; name you chose to &lt;code&gt;xvd&lt;/code&gt;. Anyway, you can suss out what exactly your instance’s OS will think the device is name using &lt;a href=&quot;http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/block-device-mapping-concepts.html&quot;&gt;this reference&lt;/a&gt;. &lt;/p&gt;

&lt;h3 id=&quot;what-does-this-all-mean-practically-like-how-do-i-actually-get-to-the-volume&quot;&gt;What does this all mean PRACTICALLY? Like how do I actually get to the volume?&lt;/h3&gt;
&lt;p&gt;Try &lt;code&gt;lsblk&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ lsblk
NAME  MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
xvdh  202:112  0   8G  0 disk
xvda1 202:1    0   8G  0 disk /
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Looks like my EBS volume got changed from &lt;code&gt;sdh&lt;/code&gt; to &lt;code&gt;xvdh&lt;/code&gt;. Yay! It’s virtualized. &lt;/p&gt;

&lt;p&gt;Anyway, the next step is to mount it, right? I have to prefix &lt;code&gt;/dev&lt;/code&gt;, since that’s the directory the special file is in.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo mount /dev/xvdh /data
mount: block device /dev/xvdh is write-protected, mounting read-only
mount: you must specify the filesystem type
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ok so actually there’s another step I haven’t explained yet. &lt;/p&gt;

&lt;h3 id=&quot;filesystems&quot;&gt;Filesystems&lt;/h3&gt;
&lt;p&gt;I originally thought that filesystems were part of the operating system, since with OSX or Windows (which is what I’ve used historically), you’d have to go out of your way to use a non-standard one. With Linux, choice is abundant. &lt;a href=&quot;http://www.howtogeek.com/howto/33552/htg-explains-which-linux-file-system-should-you-choose/&quot;&gt;This article&lt;/a&gt; has a lot of good things to say clarifying the many Linux filsystem options. For devices that are not crazily large, the standard on Linux these days is ext4 - it’s journaling (meaning it checks in both before and after writes which prevents corruption issues), it’s backwards compatible (so you can mount its predecessor ext filesystems as ext4), and it’s fast.&lt;/p&gt;

&lt;p&gt;Important note: EBS volumes &lt;em&gt;do not come with a filesystem already set up&lt;/em&gt;. That line about telling you to “specify” in the error above is a red herring. First, you have to make a filesystem with &lt;code&gt;mkfs&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo mkfs -t ext4 /dev/xvdh
mke2fs 1.42.9 (4-Feb-2014)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
524288 inodes, 2097152 blocks
104857 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2147483648
64 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done
Writing inode tables: done
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;YAYYYYYYY now we can actually &lt;code&gt;sudo mount /dev/xvdh /data&lt;/code&gt; and dump all our cat pictures on there. &lt;/p&gt;

&lt;pre&gt;&lt;code&gt;                /^--^\     /^--^\     /^--^\
                \____/     \____/     \____/
               /      \   /      \   /      \
              |        | |        | |        |
               \__  __/   \__  __/   \__  __/
|^|^|^|^|^|^|^|^|^\ \^|^|^|^/ /^|^|^|^|^\ \^|^|^|^|^|^|^|^|
| | | | | | | | | |\ \| | |/ /| | | | | | \ \ | | | | | | |
##################/ /######\ \###########/ /###############
| | | | | | | | | \/| | | | \/| | | | | |\/ | | | | | | | |
|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|_|
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;some-more-resources&quot;&gt;Some more resources&lt;/h4&gt;
&lt;p&gt;http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-using-volumes.html&lt;/p&gt;

&lt;p&gt;Special thanks to Andy Brody and Steve Woodrow for pointers and company.&lt;/p&gt;
</description>
                <link>/linux/aws/2014/12/30/Linux-block-devices</link>
                <guid>amandinemlee.com/linux/aws/2014/12/30/Linux-block-devices</guid>
                <pubDate>2014-12-30T00:00:00-08:00</pubDate>
        </item>

        <item>
                <title>Welcome</title>
                <description>
&lt;p&gt;Welcome to my blog! I was going to get right down to business, but this felt like a good time to set out what exactly
I aim to accomplish by writing things publically available on the internet.&lt;/p&gt;

&lt;p&gt;This is primarily a “technical” blog. I certainly love writing witty one-liners, posting about my personal life, or taking pictures of myself eating things - but I have twitter, facebook, and a silly tumblr for all of those respectively.&lt;/p&gt;

&lt;p&gt;My goals:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;To keep a record of stuff that I’ve learned recently for reinforcement and future reference.&lt;/li&gt;
  &lt;li&gt;To be useful to others looking for resources. For right now that will be a lot of systems and command-line utility oriented things, hopefully accessible to those who (like me) don’t have a computer architecture course under their belts. &lt;/li&gt;
  &lt;li&gt;To give myself a reason to go in depth into topics outside of work, like for example, learning how to set up a Jekyll-based blog.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <link>/2014/11/20/Welcome</link>
                <guid>amandinemlee.com/2014/11/20/Welcome</guid>
                <pubDate>2014-11-20T00:00:00-08:00</pubDate>
        </item>


</channel>
</rss>
